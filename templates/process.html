<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Process Text for Q&A</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
body{font-family:Segoe UI,Arial;background:#f6f8fb;color:#333}
.container{max-width:900px;margin:30px auto;padding:20px}
.card{background:#fff;border-radius:12px;padding:24px}
.form-control{width:100%;padding:10px;margin-bottom:12px;border-radius:8px;border:1px solid #e1e5e9}
.btn{background:#f5576c;color:#fff;padding:10px 16px;border-radius:8px;border:none;cursor:pointer}
.status{margin-top:12px;padding:10px;border-radius:8px}
.status.info{background:#d1ecf1;color:#0c5460}
.status.success{background:#d4edda;color:#155724}
.status.error{background:#f8d7da;color:#721c24}
.output-text{background:#f8f9fa;padding:12px;border-radius:8px;white-space:pre-wrap}
</style>
</head>
<body>
<div class="container">
<div class="card">
<h2><i class="fas fa-cogs"></i> Process Text for Q&A</h2>
<label for="text-file">Transcribed Text File:</label>
<input id="text-file" class="form-control" placeholder="transcribed_audio_xxx.txt">
<button id="process-btn" class="btn"><i class="fas fa-cogs"></i> Process</button>
<div id="process-status"></div>
<div id="transcription-output" style="display:none;margin-top:12px">
<h4>Transcription Preview</h4>
<div class="output-text" id="transcription-text"></div>
</div>
<div style="margin-top:14px">
<a href="/" class="btn" style="background:#2b6cb0;margin-right:8px;text-decoration:none;">Back Home</a>
<a href="/qa" class="btn" style="text-decoration:none;">Go to Q&A</a>
</div>
</div>
</div>
<script>
const processBtn = document.getElementById('process-btn');
const textFileInput = document.getElementById('text-file');
const processStatus = document.getElementById('process-status');
const transcriptionOutput = document.getElementById('transcription-output');
const transcriptionText = document.getElementById('transcription-text');

function showStatus(el,msg,type){ el.innerHTML = `<div class="status ${type}">${msg}</div>` }

// prefill from localStorage if available
const savedTextFile = localStorage.getItem('currentTextFile');
const savedTranscription = localStorage.getItem('transcribed_text');
if(savedTextFile) textFileInput.value = savedTextFile;
if(savedTranscription){ transcriptionText.textContent = savedTranscription; transcriptionOutput.style.display = 'block' }

processBtn.addEventListener('click', async ()=>{
    const text_file = textFileInput.value || localStorage.getItem('currentTextFile');
    if(!text_file){ showStatus(processStatus,'No text file specified','error'); return }
    processBtn.disabled=true; processBtn.textContent='Processing...';
    try{
        showStatus(processStatus,'Processing text...','info');
        const res = await fetch('/api/process-text',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text_file})});
        const data = await res.json();
        if(!data.success) throw new Error(data.error||'processing failed');
        localStorage.setItem('currentIndexFile', data.index_file);
        localStorage.setItem('currentChunksFile', data.chunks_file);
        showStatus(processStatus,`Processed: ${data.num_chunks} chunks created`,'success');
    }catch(err){ showStatus(processStatus,`Error: ${err.message}`,'error') }
    finally{ processBtn.disabled=false; processBtn.textContent='Process' }
});
</script>
</body>
</html>